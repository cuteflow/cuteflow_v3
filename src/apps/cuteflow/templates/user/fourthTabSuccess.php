/** gui settings tab **/cf.userFourthTab = function(){return {	thePanel				:false,	theGuiFieldset			:false,	theWorkflowFieldset		:false,		theFourthGrid			:false,	theFourthCM				:false,	theFourthStore			:false,	theFourthTopToolBar		:false,	theFirstComboStore		:false,	theSecondComboStore		:false,	theComboBox				:false,	theComboStore			:false,	theThemeFieldset		:false,				/** inits all necessarry functions **/	init: function (storeURL, userThemeUrl) {		this.initComboStore();		this.initCombo(userThemeUrl);		this.initFirstComboboxStore();		this.initSecondComboboxStore();		this.initFourthPanel();		this.initGuiFieldset();		this.initWorkflowFieldset();		this.initCM();		this.initStore(storeURL);		this.initGrid();		this.theGuiFieldset.add(this.theComboBox);		this.thePanel.add(this.theGuiFieldset);		this.theWorkflowFieldset.add(this.theFourthGrid);		this.thePanel.add(this.theWorkflowFieldset);	},					initCombo: function (storeUrl) {		this.theComboBox = new Ext.form.ComboBox({			fieldLabel: '<?php echo __('Select Theme',null,'systemsetting'); ?>',			valueField: 'plain',			displayField: 'translation',			editable: false,			id: 'userFourthTab_theme_id',			hiddenName : 'userFourthTab_theme',			mode: 'local',			store: this.theComboStore,			triggerAction: 'all',			selectOnFocus:true,			allowBlank: true,			forceSelection:true,			width: 200		});		this.theComboBox.on('afterrender', function(combo) {			Ext.Ajax.request({  				url: storeUrl,				success: function(objServerResponse){					data = Ext.util.JSON.decode(objServerResponse.responseText);					var result = data.result;					var defaultData;					for(var a=0;a<result.length;a++) {						var item = result[a];						var Rec = Ext.data.Record.create({name: 'plain'},{name: 'translation'},{name: 'isDefault'});						cf.userFourthTab.theComboBox.store.add(new Rec({plain: item.plain, translation: item.translation,isDefault: item.isDefault}));						if(item.isDefault == 1) {							defaultData = item.plain;						}					}					cf.userFourthTab.theComboBox.setValue(defaultData);									}				}); 	    });		},		initComboStore: function () {		this.theComboStore = new Ext.data.SimpleStore({			fields: [{name: 'plain'},{name: 'translation'},{name: 'isDefault'}]		});			},					/** init cm **/	initCM: function () {		this.theFourthCM  =  new Ext.grid.ColumnModel([			{header: "<center><div ext:qtip=\"<table><tr><td><img src='/images/icons/checkbox.png' />&nbsp;&nbsp;</td><td><?php echo __('Activate Item',null,'systemsetting'); ?></td></tr></table>\" ext:qwidth=\"200\"><?php echo __('Activate Item',null,'usermanagement'); ?></div></center>",  width: 90, sortable: false, dataIndex: 'id', css : "text-align :left; font-size:12px;", renderer: cf.userFourthTab.renderAction},			{header: "<?php echo __('Column',null,'usermanagement'); ?>",  width: 200, sortable: false, dataIndex: 'columntext', css : "text-align :left; font-size:12px;", renderer: this.renderCombobox}		]);		},		initFirstComboboxStore: function () {		this.theFirstComboStore = new Ext.data.JsonStore({			root: 'result',			url: '<?php echo build_dynamic_javascript_url('field/LoadAllFields')?>',			fields: [				{name: 'id'},				{name: 'title'}			]		});		this.theFirstComboStore.load();		cf.userFourthTab.theFirstComboStore.on('load', function(grid) {			var Rec = Ext.data.Record.create({name: 'id'},{name: 'title'});			cf.userFourthTab.theFirstComboStore.insert(0,new Rec({id: 'USERDEFINED1', title: '<?php echo __('USERDEFINED1',null,'systemsetting'); ?>'})); // important to add unique ID's		});			},	initSecondComboboxStore: function () {		this.theSecondComboStore = new Ext.data.JsonStore({			root: 'result',			url: '<?php echo build_dynamic_javascript_url('field/LoadAllFields')?>',			fields: [				{name: 'id'},				{name: 'title'}			]		});		this.theSecondComboStore.load();		cf.userFourthTab.theSecondComboStore.on('load', function(grid) {			var Rec = Ext.data.Record.create({name: 'id'},{name: 'title'});			cf.userFourthTab.theSecondComboStore.insert(0,new Rec({id: 'USERDEFINED2', title: '<?php echo __('USERDEFINED2',null,'systemsetting'); ?>'})); // important to add unique ID's		});			},				renderCombobox: function (data, cell, record, rowIndex, columnIndex, store, grid) {		if(record.data['column'] == 'USERDEFINED1') {			cf.userFourthTab.createFirstCombo.defer(500,this,[record.data['column'],record.data['field_id']]);			return '<div id="edituser_'+record.data['column']+'"></div>';		}		else if(record.data['column'] == 'USERDEFINED2') {			cf.userFourthTab.createSecondCombo.defer(500,this,[record.data['column'],record.data['field_id']]);			return '<div id="edituser_'+record.data['column']+'"></div>';		}		return record.data['columntext'];	},			createFirstCombo: function (id, field_id) {		var value;		if(field_id == -2) {			value = 'USERDEFINED1';		}		else if(field_id >= 1) {			value = field_id;		}		else {			value = id;		}		var combo = new Ext.form.ComboBox ({			renderTo: 'edituser_'+id,			mode: 'local',			id:'userdefined_firstcombo',			displayField: 'title',			valueField: 'id',			editable:false,			width:150,			value: value,			allowBlank: true,			autoHeight:true,			triggerAction: 'all',			foreSelection: true,			store: cf.userFourthTab.theFirstComboStore,			listeners: {				select: {					fn:function(combo, value) {						combo.setValue(combo.getValue());					}				}			}		});					},	createSecondCombo: function (id, field_id) {		var value;		if(field_id == -2) {			value = 'USERDEFINED2';		}		else if(field_id >= 1) {			value = field_id;		}		else {			value = id;		}		var combo = new Ext.form.ComboBox ({			renderTo: 'edituser_'+id,			mode: 'local',			id:'userdefined_secondcombo',			displayField: 'title',			editable:false,			allowBlank: true,			width:150,			valueField: 'id',			autoHeight:true,			value: value,			triggerAction: 'all',			foreSelection: true,			store: cf.userFourthTab.theSecondComboStore,			listeners: {				select: {					fn:function(combo, value) {						combo.setValue(combo.getValue());					}				}			}		});	},			/** init store **/	initStore: function (storeURL) {		this.theFourthStore = new Ext.data.JsonStore({			root: 'result',			url:  storeURL,			fields: [				{name: 'id'},				{name: 'columntext'},				{name: 'column'},				{name: 'field_id'},				{name: 'isactive',type: 'bool'}			]		});	},		/** init grid **/	initGrid: function () {		this.theFourthGrid = new Ext.grid.GridPanel({			frame:false,			autoScroll: true,			collapsible:false,			closable: false,			ddGroup : 'userFourthTabGridDD',			height: 340,			width: 400,			allowContainerDrop : true,			enableDragDrop:true,			border: true,			store: this.theFourthStore,			cm: this.theFourthCM		});		this.theFourthGrid.on('afterrender', function(grid) {			cf.userFourthTab.theFourthStore.load();		});				this.theFourthGrid.on('afterrender', function(grid) {			var ddrow = new Ext.dd.DropTarget(grid.container, {                ddGroup: 'userFourthTabGridDD',                copy:false,                notifyDrop: function(ddSource, e, data){					var sm = grid.getSelectionModel();  					var rows = sm.getSelections();  					var cindex = ddSource.getDragData(e).rowIndex;  					 if (sm.hasSelection()) {  						if(typeof(cindex) != "undefined") {							for (i = 0; i < rows.length; i++) {  								grid.store.remove(grid.store.getById(rows[i].id));  								grid.store.insert(cindex,rows[i]);  							}  						}						else { // when trying to add data to the end of the grid							var total_length = grid.store.data.length+1;							for (i = 0; i < rows.length; i++) {  								grid.store.remove(grid.store.getById(rows[i].id));							}							grid.store.add(rows);						}					} 					sm.clearSelections();				}		   }); 		});	},	/** renderer for checkbox **/		renderAction: function (data, cell, record, rowIndex, columnIndex, store, grid) {		var id = record.data['id'];		cf.userFourthTab.createCheckbox.defer(500,this, [id,  record.data['isactive']]);		return '<center><table><tr><td><div id="theFourthGridCheckbox_'+ id +'"></div></td></tr></table></center>';	},		/** render checkbox **/	createCheckbox: function (id, check_value) {		var check = new Ext.form.Checkbox({			renderTo: 'theFourthGridCheckbox_' + id,			checked: check_value,			handler: function (checkbox) {				cf.userFourthTab.theFourthGrid.store.findExact('id', id ).data.isactive = checkbox.checked;	            }		});	},		/** init the panel for the tab **/	initFourthPanel: function () {		this.thePanel = new Ext.Panel({			modal: true,			closable: false,			modal: true,			width: 650,			height: cf.Layout.theRegionWest.getHeight() + cf.Layout.theRegionNorth.getHeight() - 230,			autoScroll: true,			title: '<?php echo __('GUI Settings',null,'usermanagement'); ?>',			shadow: false,			minimizable: false,			draggable: false,			resizable: false,	        plain: false		});	},		/** init gui fieldset **/	initGuiFieldset: function () {		this.theGuiFieldset = new Ext.form.FieldSet({			title: '<?php echo __('GUI Settings',null,'usermanagement'); ?>',			width: 600,			height: 'auto',			style: 'margin-top:20px;margin-left:5px;',			labelWidth: 330,			items:[{				xtype: 'combo', // number of records to display in grid				id: 'userFourthTab_itemsperpage_id',				mode: 'local',				value: '25',				fieldLabel: '<?php echo __('Items per page',null,'usermanagement'); ?>',				editable:false,				allowBlank: true,				autoHeight:true,				hiddenName: 'userFourthTab_itemsperpage',				triggerAction: 'all',				foreSelection: true,				store: new Ext.data.SimpleStore({					 fields:['id','text'],       				 data:[[25, '25'],[50, '50'],[75, '75'],[100, '100']]   				}), 				valueField:'id',				displayField:'text',				width:50			},{				xtype: 'combo', // number of records to display in grid				id: 'userFourthTab_refreshtime_id',				mode: 'local',				value: '30',				fieldLabel: '<?php echo __('Refreshtime in seconds',null,'usermanagement'); ?>',				editable:false,				allowBlank: true,				autoHeight:true,				hiddenName: 'userFourthTab_refreshtime',				triggerAction: 'all',				foreSelection: true,				store: new Ext.data.SimpleStore({					 fields:['id','text'],       				 data:[[30, '30'],[60, '60'],[120, '120'],[180, '180'],[240, '240'], [300, '300']]   				}), 				valueField:'id',				displayField:'text',				width:50			},{				xtype: 'panel',				layout: 'column',				border: false,				layoutConfig: {					columns:3				},				labelWidth: 150,				fieldLabel: '<?php echo __('Circulations default sort',null,'usermanagement'); ?>',				width: 200,				items: [{					xtype: 'combo', // number of records to display in grid					id: 'userFourthTab_circulationdefaultsortcolumn_id',					name: 'type',					mode: 'local',					value: 'NAME',					editable:false,					allowBlank: true,					autoHeight:true,					hiddenName: 'userFourthTab_circulationdefaultsortcolumn',					triggerAction: 'all',					foreSelection: true,					store: new Ext.data.SimpleStore({						 fields:['id','text'],	       				 data:[['NAME', '<?php echo __('Name',null,'usermanagement'); ?>'],['STATION', '<?php echo __('Station',null,'usermanagement'); ?>'],['DAYS', '<?php echo __('Days',null,'usermanagement'); ?>'],['START', '<?php echo __('Start',null,'usermanagement'); ?>'],['SENDER', '<?php echo __('Sender',null,'usermanagement'); ?>'],['TOTALTIME', '<?php echo __('Total time',null,'usermanagement'); ?>'],['MAILINGLIST', '<?php echo __('Mailing list',null,'usermanagement'); ?>'],['TEMPLATE', '<?php echo __('Template',null,'usermanagement'); ?>']]	   				}),	 				valueField:'id',					displayField:'text',					width:85								},{    				xtype: 'panel',    				html : '&nbsp;',    				border: false,					id: 'userFourthTab_spacepanel1'    			},{					xtype: 'combo', // number of records to display in grid					id: 'userFourthTab_circulationdefaultsortdirection_id',					name: 'type',					mode: 'local',					value: 'ASC',					editable:false,					allowBlank: true,					autoHeight:true,					hiddenName: 'userFourthTab_circulationdefaultsortdirection',					triggerAction: 'all',					foreSelection: true,					store: new Ext.data.SimpleStore({						 fields:['id','text'],	       				 data:[['ASC', '<?php echo __('Ascending',null,'usermanagement'); ?>'],['DESC', '<?php echo __('Descending',null,'usermanagement'); ?>']]	   				}),	 				valueField:'id',					displayField:'text',					width:100				}]			},{				xtype:'textfield',				fieldLabel: '<?php echo __('Change yellow after...days',null,'usermanagement'); ?>',				width:40,				value: '7',				id:'userFourthTab_markyellow'			},{				xtype:'textfield',				fieldLabel: '<?php echo __('Change orange after...days',null,'usermanagement'); ?>',				width:40,				value: '10',				id:'userFourthTab_markorange'			},{				xtype:'textfield',				fieldLabel: '<?php echo __('Change red after...days',null,'usermanagement'); ?>',				width:40,				value: '12',				id:'userFourthTab_markred'			}]		});				if (Ext.isIE6 == true) {			Ext.getCmp('userFourthTab_spacepanel1').html = '';			Ext.getCmp('userFourthTab_spacepanel1').setSize({width:5,height:0});		}		else if(Ext.isOpera == true || Ext.isSafari == true) {		}		else if (Ext.isIE7 == true) {			/*Ext.getCmp('userFourthTab_circulationdefaultsortdirection_id').style = 'margin-top:0px;margin-bottom:1px;';			Ext.getCmp('userFourthTab_circulationdefaultsortcolumn_id').style = 'margin-top:0px;margin-bottom:1px;';			Ext.getCmp('userFourthTab_itemsperpage_id').style = 'margin-top:0px;margin-bottom:1px;';			Ext.getCmp('userFourthTab_refreshtime_id').style = 'margin-top:0px;margin-bottom:1px;';*/		}	},		/** init worklfow fieldset for grid **/	initWorkflowFieldset: function () {		this.theWorkflowFieldset = new Ext.form.FieldSet({			title: '<?php echo __('Worklfow Circulation settings',null,'usermanagement'); ?>',			width: 600,			height: 'auto',			style: 'margin-top:20px;margin-left:5px;',			labelWidth: 330		});	}};}();